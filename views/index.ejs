<!DOCTYPE html>
<html lang="en" ng-app="hungry4zone">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Hungry4Zone - Gustose ricette per la tua dieta a zona</title>

    <!-- Bootstrap core CSS (via CDN)-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <!-- NG Tags Input-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/ng-tags-input/3.0.0/ng-tags-input.min.css" rel="stylesheet">
    <!-- Custom styles -->
    <link rel='stylesheet' href='/stylesheets/h4z.css' />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" ng-controller="NavbarController">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#/">Hungry 4 Zone</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="#/planner">Planner Pasti</a></li>
            <li><a href="#/mealsGallery">Ricettario</a></li>
            <li><a href="#/calculator">Calcolatore</a></li>
          </ul>
          <form ng-show="$storage.loggedUser" class="navbar-form navbar-right">
            <div class="form-group text-white">
              Utente: {{$storage.loggedUser.name}}&nbsp;&nbsp;&nbsp;
            </div>
            <button type="button" class="btn btn-success" ng-click="OnLogoutClicked()">Esci</button>
          </form>
          <form ng-show="!$storage.loggedUser" class="navbar-form navbar-right">
            <a role="button" class="btn btn-success" href="#/login">Entra</a>
            <div class="form-group text-white">
              &nbsp;&nbsp;&nbsp;oppure&nbsp;<a href="#/signup">Registrati</a>
            </div>
          </form>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>


    <ng-view></ng-view>

    <div class="container">
      <hr>
      <footer>
        <p>&copy; Hungry4Zone 2015</p>
      </footer>
    </div>

    <!-- Libraries - uncompressed version -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-route.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-resource.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-touch.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.6/ngStorage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ng-tags-input/3.0.0/ng-tags-input.js"></script>
    <script src="/javascripts/ui-bootstrap-tpls-0.13.3.min.js"></script>
    <script src="/javascripts/raphael-2.1.4.min.js"></script>
    <script src="/javascripts/justgage.1.0.1.min.js"></script>

    <!-- Libraries - minified version for production -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-resource.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-touch.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.6/ngStorage.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ng-tags-input/3.0.0/ng-tags-input.min.js"></script>
    <script src="/javascripts/ui-bootstrap-tpls-0.13.3.js"></script>
    <script src="/javascripts/raphael-2.1.4.min.js"></script>
    <script src="/javascripts/justgage.1.0.1.min.js"></script> -->

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-analytics.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyAUuWFDZ7RjsgCdEVXXH9mMqlROeakSllI",
      authDomain: "hungry4zone-ff734.firebaseapp.com",
      databaseURL: "https://hungry4zone-ff734.firebaseio.com",
      projectId: "hungry4zone-ff734",
      storageBucket: "hungry4zone-ff734.appspot.com",
      messagingSenderId: "877561491154",
      appId: "1:877561491154:web:43d2a7a7d6ecb1e1a7c70b",
      measurementId: "G-HRS57FR7DN"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>

    <script>
      //---------------
      // Main app
      //---------------

      var app = angular.module("hungry4zone", ['ngRoute', 'ngResource', 'ui.bootstrap', 'ngStorage', 'ngTouch', 'ngTagsInput']);
    </script>

    <!-- General functions  -->
    <script src="/generalFunctions.js"></script>
    <script src="/ui/filters.js"></script>

    <!-- Services  -->
    <script src="/ui/factories.js"></script>
    <script src="/ui/services.js"></script>

    <!-- Controllers -->
    <script src="/ui/ui_home.js"></script>
    <script src="/ui/ui_calculator.js"></script>
    <script src="/ui/ui_foods.js"></script>
    <script src="/ui/ui_navbar.js"></script>
    <script src="/ui/ui_foodDetails.js"></script>
    <script src="/ui/ui_upload.js"></script>
    <script src="/ui/ui_signup.js"></script>
    <script src="/ui/ui_login.js"></script>
    <script src="/ui/ui_forgotPassword.js"></script>
    <script src="/ui/ui_resetPassword.js"></script>
    <script src="/ui/ui_meal.js"></script>
    <script src="/ui/ui_mealsGallery.js"></script>
    <script src="/ui/ui_planner.js"></script>
    <script src="/ui/ui_imagePicker.js"></script>

    <script>
      app.run(function($rootScope, $sessionStorage, $location, SharedInfos, Users) {
        $rootScope.$on( "$routeChangeStart", function(event, next, current) {
          if (next.originalPath === "/meal" || next.originalPath === "/planner") {
            // no logged user, redirect to /login
            if (!$sessionStorage.loggedUser) {
              SharedInfos.set("alert", { "type" : "warning", "msg" : "Per aprire questa pagina devi prima effettuare l'accesso"});
              SharedInfos.set("forwardAddress", next.originalPath)
              $location.path("/login");
            }
          }
        })
      });

      //---------------
      // Routes
      //---------------

      //=============================================================================
      app.config(['$routeProvider', function ($routeProvider, $location) {
        $routeProvider
          .when('/', {
            templateUrl: '/ui/ui_home.html',
            controller: 'HomeController'
          })
          .when('/calculator', {
            templateUrl: '/ui/ui_calculator.html',
            controller: 'CalculatorController'
          })
          .when('/foods', {
            templateUrl: '/ui/ui_foods.html',
            controller: 'FoodsController'
          })
          .when('/upload', {
            templateUrl: '/ui/ui_upload.html',
            controller: 'UploadController'
          })
          .when('/foodDetail/:id', {
            templateUrl: '/ui/ui_foodDetails.html',
            controller: 'FoodDetailController'
          })
          .when('/signup', {
            templateUrl: '/ui/ui_signup.html',
            controller: 'SignupController'
          })
          .when('/login', {
            templateUrl: '/ui/ui_login.html',
            controller: 'LoginController'
          })
          .when('/forgotPassword', {
            templateUrl: '/ui/ui_forgotPassword.html',
            controller: 'ForgotPasswordController'
          })
          .when('/resetPassword', {
            templateUrl: '/ui/ui_resetPassword.html',
            controller: 'ResetPasswordController'
          })
          .when('/meal', {
            templateUrl: '/ui/ui_meal.html',
            controller: 'MealController'
          })
          .when('/mealsGallery', {
            templateUrl: '/ui/ui_mealsGallery.html',
            controller: 'MealsGalleryController'
          })
          .when('/planner', {
            templateUrl: '/ui/ui_planner.html',
            controller: 'PlannerController'
          })
          .when('/imagePicker', {
            templateUrl: '/ui/ui_imagePicker.html',
            controller: 'ImagePickerController'
          })
      }]);
    </script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- // <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->

    <script>
      // https://stackoverflow.com/questions/16680543/hide-twitter-bootstrap-nav-collapse-on-click
      $('.nav a').on('click', function(){
        if ($('.navbar-toggle').css('display') != 'none') {
          $('.navbar-toggle').click();
        }
      });
    </script>

  </body>
</html>
